<div
  [class.dfm-table-wrapper-collapse]="collapseOnMobile"
  class="dfm-table-wrapper"
  #tableWrapper
  infiniteScroll
  (scrolled)="scrolled.emit()"
  [scrollWindow]="false"
>
  <table
    [class.last-frozen]="stickyActions && dataTableService.isOverflown() && dataTableService.hasActions()"
    [class.first-frozen]="stickyFirstColumn && dataTableService.isOverflown()"
    (resized)="checkTableSize($event)"
  >
    <thead *ngIf="headers && headers.length > 0" [ngClass]="{ 'dfm-sticky-header': stickyHeader }">
      <tr>
        <ng-container *ngIf="selectable">
          <dfm-data-table-header-cell
            class="checkbox-cell"
            [class.checkbox-frozen]="stickyCheckbox && dataTableService.isOverflown()"
            [class.checkbox-first-frozen]="stickyFirstColumn && dataTableService.isOverflown()"
          >
            <dfm-checkbox class="d-flex dfm-me-2" [ngModel]="areAllSelected" (click)="selectAllItems()"></dfm-checkbox>
          </dfm-data-table-header-cell>
        </ng-container>
        <ng-container *ngFor="let header of headers">
          <dfm-data-table-header-cell (click)="sortClicked(header.title)" [header]="header" [headerSize]="headerSize"></dfm-data-table-header-cell>
        </ng-container>
        <dfm-data-table-header-cell *ngIf="dataTableService.hasActions() || actionsHeader || actionsHeaderIcon">
          <ng-container *ngIf="(actionsHeader || actionsHeaderIcon) && !dataTableService.isOverflown()">
            <button
              (click)="actionsHeaderClicked.emit()"
              [ngbTooltip]="actionsHeaderTooltip"
              dfm-button
              color="secondary-gray"
              [leadingIcon]="actionsHeaderIcon ?? ''"
              size="sm"
              class="float-end"
            >
              <ng-container *ngIf="actionsHeader">
                {{ actionsHeader }}
              </ng-container>
            </button>
          </ng-container>
        </dfm-data-table-header-cell>
      </tr>
    </thead>

    <tbody>
      <ng-container *ngIf="data && data.items && data.items.length > 0; else noData">
        <tr *ngFor="let item of data.items" class="body-row" (click)="click(item)" [class.pointer]="rowClickable">
          <ng-container *ngIf="selectable">
            <dfm-table-row-cell
              [propagateClick]="false"
              class="checkbox-cell"
              [class.checkbox-frozen]="stickyCheckbox && dataTableService.isOverflown()"
              [class.checkbox-first-frozen]="stickyFirstColumn && dataTableService.isOverflown()"
            >
              <dfm-checkbox class="d-flex dfm-me-2" [ngModel]="getSelectedById(item.id)" (ngModelChange)="selectItem($event, item.id)"></dfm-checkbox>
            </dfm-table-row-cell>
          </ng-container>
          <ng-container *ngTemplateOutlet="bodyRowTemplate; context: { $implicit: item }"></ng-container>
        </tr>
      </ng-container>
      <ng-template #noData>
        <tr>
          <td [attr.colspan]="headers.length" class="no-data-cell dfm-py-16 text-sm-medium dfm-text-main-700">
            {{ noDataMessage }}
          </td>
        </tr>
      </ng-template>
    </tbody>
  </table>
</div>
